services:
  # Development environment with live reload
  tremtec-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    image: tremtec:dev
    container_name: tremtec-dev
    ports:
      - "4000:4000"
    env_file:
      - .env
    environment:
      PORT: "4000"
      PHX_SERVER: "true"
      PHX_HOST: "0.0.0.0"
      DATABASE_PATH: /data/tremtec_dev.db
      MIX_ENV: dev
    volumes:
      - .:/app
      - tremtec_dev_data:/data
    restart: unless-stopped
    profiles:
      - dev

  # Production environment
  tremtec-prod:
    build:
      context: .
      dockerfile: Dockerfile
    image: tremtec:latest
    container_name: tremtec-prod
    environment:
      PORT: "4000"
      PHX_SERVER: "true"
      PHX_HOST: localhost
      DATABASE_PATH: /data/tremtec.db
      MIX_ENV: prod
    ports:
      - "4001:4000"
    volumes:
      - tremtec_prod_data:/data
    restart: unless-stopped
    env_file:
      - .env
      - .env.production
    profiles:
      - prod

volumes:
  tremtec_dev_data:
    driver: local
  tremtec_prod_data:
    driver: local
