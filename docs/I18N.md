# Internationalization (i18n) Documentation

This directory contains comprehensive documentation for the Tremtec i18n system.

## Quick Links

- [**I18N_OVERVIEW.md**](./I18N_OVERVIEW.md) - Complete feature overview
- [**I18N_SETUP.md**](./I18N_SETUP.md) - How the system is configured
- [**I18N_LOCALES.md**](./I18N_LOCALES.md) - Supported languages and locale codes
- [**I18N_ADDING_TRANSLATIONS.md**](./I18N_ADDING_TRANSLATIONS.md) - How to add new strings
- [**I18N_ADDING_LOCALES.md**](./I18N_ADDING_LOCALES.md) - How to support new languages

## Quick Reference

### Supported Locales

| Code | Language | Region | Default |
|------|----------|--------|---------|
| pt | Português | Brazil/Portugal | ✅ Yes |
| en | English | International | No |
| es | Español | Spain/Latin America | No |

### Using Translations in Code

**Templates (HEEx)**:
```heex
{gettext("Welcome")}
<.input placeholder={gettext("Enter your name")} />
```

**Elixir Code**:
```elixir
use Gettext, backend: TremtecWeb.Gettext

gettext("Welcome message")
dgettext("errors", "can't be blank")
```

### Locale Detection

The app detects locale in this order:
1. **Cookie** (`preferred_locale`) - User preference
2. **Accept-Language header** - Browser language
3. **Default** - Portuguese (pt)

### Key Files

**Core Infrastructure**:
- `lib/tremtec_web/plug/determine_locale.ex` - Locale detection
- `lib/tremtec_web/helpers/locale_helpers.ex` - Locale utilities
- `lib/tremtec_web/gettext.ex` - Gettext configuration
- `lib/tremtec_web/router.ex` - Plug integration

**Translation Files**:
- `priv/gettext/pt/LC_MESSAGES/default.po` - Portuguese strings
- `priv/gettext/en/LC_MESSAGES/default.po` - English strings
- `priv/gettext/es/LC_MESSAGES/default.po` - Spanish strings
- `priv/gettext/{locale}/LC_MESSAGES/errors.po` - Validation errors

## Common Tasks

### Add a new translatable string

1. Wrap in `gettext()`:
   ```heex
   {gettext("My new string")}
   ```

2. Extract strings:
   ```bash
   mix gettext.extract --merge
   ```

3. Add translations to `.po` files

4. Restart server

### Add a new language

See [I18N_ADDING_LOCALES.md](./I18N_ADDING_LOCALES.md)

### Set user's preferred locale

```elixir
# In a controller or LiveView
TremtecWeb.LocaleHelpers.set_locale(conn, "es")
```

### Get current locale

```elixir
locale = TremtecWeb.LocaleHelpers.get_locale(conn_or_socket)
```

## Testing

Use `gettext()` in test assertions, never hardcoded strings:

```elixir
test "shows translated message" do
  success_msg = gettext("Thanks! Your message has been sent.")
  assert html =~ success_msg
end
```

For error messages, use `dgettext()`:

```elixir
test "validates email" do
  error_msg = dgettext("errors", "has invalid format")
  assert html =~ error_msg
end
```

## Implementation Status

✅ **Phase 1**: Core infrastructure (Gettext, locale detection, helpers)
✅ **Phase 2**: Brand name localization (TremTec, logo, tagline)
✅ **Phase 3**: Spanish locale support (62 strings + 24 errors)

**Current Coverage**:
- Portuguese: 62 user strings + 24 errors
- English: 62 user strings + 24 errors
- Spanish: 62 user strings + 24 errors

**Total**: 3 languages × 86 translations = 258 translations

## Architecture

```
┌─────────────────┐
│  User Request   │
└────────┬────────┘
         │
    ┌────▼─────┐
    │  Browser │
    │ Headers  │
    └────┬─────┘
         │
    ┌────▼──────────────────────────────┐
    │   DetermineLocale Plug             │
    │                                     │
    │  1. Check cookie (preferred_locale)│
    │  2. Parse Accept-Language header   │
    │  3. Fallback to "pt" (Portuguese)  │
    └────┬──────────────────────────────┘
         │
    ┌────▼─────────────┐
    │ Gettext Backend  │
    │ Set locale for   │
    │ this request     │
    └────┬─────────────┘
         │
    ┌────▼──────────────┐
    │  Template Render  │
    │  gettext() calls  │
    │  return translated│
    │  strings from .po │
    └───────────────────┘
```

## References

- [Gettext Documentation](https://hexdocs.pm/gettext)
- [Phoenix i18n Guide](https://hexdocs.pm/phoenix/locale)
- [AGENTS.md i18n Guidelines](../AGENTS.md) - Development patterns

## Contributing

When adding new features:

1. Always use `gettext()` for user-facing strings
2. Use `dgettext("errors", "...")` for validation messages
3. Extract with `mix gettext.extract --merge`
4. Translate to all supported locales
5. Test with different locale settings

See [I18N_ADDING_TRANSLATIONS.md](./I18N_ADDING_TRANSLATIONS.md) for detailed steps.
